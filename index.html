<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>How It Works â€” S2 (Topo + Satellite)</title>
    <link rel="stylesheet" href="./styles.css" />
  </head>
  <body>
    <main>
      <!-- S2: pinned scene -->
      <section id="section-s2" class="pin-section">
        <!-- existing layers you already use -->
        <div id="topoMount" class="layer layer--topo" aria-hidden="true"></div>
        <div
          id="satMount"
          class="layer layer--sat"
          aria-label="Satellite"
        ></div>

        <!-- NEW: dots path overlay (locked to scene) -->
        <div id="dotsMount" class="layer layer--dots" aria-hidden="true"></div>
      </section>

      <!-- scroll room -->
      <section class="spacer"></section>
      <section class="spacer"></section>
    </main>

    <!-- GSAP + ScrollTrigger -->
    <script src="https://cdn.jsdelivr.net/npm/gsap@3/dist/gsap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gsap@3/dist/ScrollTrigger.min.js"></script>

    <script src="./main.js?v=hybrid-fix-1"></script>
    <script>
      (function () {
        function hasDebugFlag() {
          try {
            const params = new URLSearchParams(window.location.search);
            return (
              params.get('debug') === '1' ||
              window.localStorage.getItem('DEBUG_S2') === '1'
            );
          } catch (_) {
            return false;
          }
        }
        function inject(tag, attrs, onload) {
          const el = document.createElement(tag);
          for (const k in attrs) el.setAttribute(k, attrs[k]);
          if (onload) {
            el.addEventListener('load', function () { onload(); });
          }
          document.head.appendChild(el);
          return el;
        }
        let assetsLoading = false;
        let assetsLoaded = false;
        function loadOverlayAssets(cb) {
          if (assetsLoaded) { cb && cb(); return; }
          if (assetsLoading) {
            const id = setInterval(function () {
              if (assetsLoaded) { clearInterval(id); cb && cb(); }
            }, 50);
            return;
          }
          assetsLoading = true;
          const cbv = Date.now().toString();
          inject('link', { rel: 'stylesheet', href: './debug/debug-overlay.css?cb=' + cbv });
          inject('script', { src: './debug/debug-overlay.js?cb=' + cbv }, function () {
            assetsLoaded = true;
            assetsLoading = false;
            cb && cb();
          });
        }
        function toggleOverlay() {
          if (window.__S2_DEBUG__) {
            window.__S2_DEBUG__.toggle();
            return;
          }
          loadOverlayAssets(function () {
            if (window.__S2_DEBUG__) window.__S2_DEBUG__.toggle();
          });
        }
        // Global Shift+D to toggle, even if not preloaded
        window.addEventListener('keydown', function (e) {
          if (e.key === 'D' && e.shiftKey && !e.altKey && !e.ctrlKey && !e.metaKey) {
            e.preventDefault();
            toggleOverlay();
          }
        }, { passive: false });
        if (hasDebugFlag()) {
          loadOverlayAssets(function () {
            if (window.__S2_DEBUG__ && window.__S2_DEBUG__.show) {
              window.__S2_DEBUG__.show();
            }
          });
        }
      })();
    </script>
  </body>
</html>
